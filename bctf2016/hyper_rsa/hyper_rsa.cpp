// g++ -std=c++11 -o hyper_rsa ./hyper_rsa.cpp -lgmpxx -lgmp -fopenmp

#include <gmpxx.h>
#include <iostream>
#include <unordered_map>

using namespace std;

int main() {
    mpz_class m1, c1, n1, n2, p1, q1, p2, q2, phi1, phi2, e2, d2, cc;
    m1 = "1291575311227647404937745977674300102552159140130724372672273512124326901689475940631797723907388299601908770592275163938119318483657985194901345321320";
    c1 = "3612783941217721669487918278209911521323696929552012175100130528144953435277957012327876297909487756767163399469731122537754642368918321895211682844060051902226307200945658526452184995263241224610748656158064831467711457662659609765597325107742484418555573571733455873166185394833773943367518472411975358177757721075900099526140241289604501293079211412322023186020382617546224962628798465635111775435684570876736680218992899063074934853328180993221927800114698375815660980849891750946707282694641977171200300901905249566807230865872745785916874656741470951342227797544099362706484433003094851882722308369118455538479";
    phi1 = "15648839760729136857611980482709455780823249059433822421717774306890912422191494755459005142111607992828285551194094172211798962121953438089140493712726087426107589267481640653515380577953758668008397344082640238769913089651014044547964783609544160815580263066891992072813496322236255529332740322328153851312711004593214404575887025736676274899765203790583937534350844983721442711863657743581932579473338893978821261293414201279867341661254915418438631755828487072344966512444153487836044985984019971569210835548709975449707113394836826729194310900996970311050590701739087807529180979948206673288410310288648934034132";
    phi2 = "27651436873059903761538209234805214287355683678982466405670882487591411436642516539341196342881585483549012954046212429788184908293604454771642818107648395738428697059696871430441866540519287523373879820608795756105878030307235272632107775558053732559632831099019813290110266640343749177716635424859416795786402417550941254682844793918923312719478486698405636128755743304320470822934907638822367467488371646298188938832766457232505325343147749926218573633056287100454561709942367164443238193435129072452012937946747494560619518939691378193557413898927772653559607367624610033398203976718055268349668959003489229927396";
    n1 = "15648839760729136857611980482709455780823249059433822421717774306890912422191494755459005142111607992828285551194094172211798962121953438089140493712726087426107589267481640653515380577953758668008397344082640238769913089651014044547964783609544160815580263066891992072813496322236255529332740322328153851312961936661859569054622011061087082284128807141569973069232563526976554397613026154984099426439128269723550458457280468287574830259658190319585969033124798862730603620119663542163404213185266003198150728644986436777489704208328734400642015199114476591920301342491956560907159473860286478358614493839228472359041";
    n2 = "27651436873059903761538209234805214287355683678982466405670882487591411436642516539341196342881585483549012954046212429788184908293604454771642818107648395738428697059696871430441866540519287523373879820608795756105878030307235272632107775558053732559632831099019813290110266640343749177716635424859416795786735047143696302657241912433915888805902148923106710885221002650355051396187383500174867165635719900881013089530132697822486081686748180965007087119379517849387088878883805428586240671351051269319387834355886582079118795891068466933583725489045111641949617725339393138570317367622108145858007000011779852522969";

    unordered_map<unsigned long, unsigned long> table;

    for (unsigned long e1 = 100000001; e1 <= 199999999; e1 += 2) {
        if (e1 % 10000 == 1) {
            cout << e1 << endl;
        }
        mpz_powm_ui(cc.get_mpz_t(), m1.get_mpz_t(), e1, n1.get_mpz_t());
        table[cc.get_ui()] = e1;
    }

    #pragma omp parallel for private(d2,cc,e2)
    for (unsigned long i = 200000001; i <= 299999999; i += 2) {
        if (i % 1000 == 1) {
            cout << i << endl;
        }
        e2 = i;
        mpz_invert(d2.get_mpz_t(), e2.get_mpz_t(), phi2.get_mpz_t());
        mpz_powm(cc.get_mpz_t(), c1.get_mpz_t(), d2.get_mpz_t(), n2.get_mpz_t());
        if (table.find(cc.get_ui()) != table.end()) {
            cout << "found: " << table[cc.get_ui()] << " " << e2 << " " << cc.get_ui() << endl;
        }
    }

    return 0;
}

// found: 134217757 251658263 1547671861191386274
